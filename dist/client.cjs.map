{
  "version": 3,
  "sources": ["../src/client.tsx"],
  "sourcesContent": ["import React, { useEffect, useState } from \"react\";\nimport { createRoot } from \"react-dom/client\";\nimport { createFromFetch } from \"react-server-dom-webpack/client\";\nimport type { Root } from \"react-dom/client\";\n\ntype ClientOptions = {\n  rootId?: string;\n  rscEndpoint?: string;\n};\n\nexport type RouterClient = {\n  push: (href: string) => void;\n  replace: (href: string) => void;\n  refresh: () => void;\n};\n\nconst noopRouter: RouterClient = {\n  push: () => {},\n  replace: () => {},\n  refresh: () => {},\n};\n\nexport type CookieOptions = {\n  path?: string;\n  domain?: string;\n  secure?: boolean;\n  sameSite?: \"Strict\" | \"Lax\" | \"None\";\n  maxAge?: number;\n  expires?: Date;\n};\n\nexport type CookieClient = {\n  all: () => Record<string, string>;\n  get: (name: string) => string | undefined;\n  set: (name: string, value: string, options?: CookieOptions) => void;\n  remove: (name: string, options?: Omit<CookieOptions, \"maxAge\" | \"expires\">) => void;\n};\n\nconst RouterContext: React.Context<RouterClient | null> | null =\n  typeof (React as unknown as { createContext?: unknown }).createContext === \"function\"\n    ? React.createContext<RouterClient | null>(null)\n    : null;\nconst GLOBAL_ROUTER_KEY = \"__WEBFRAMEZ_ROUTER__\";\n\nfunction readGlobalRouter() {\n  if (typeof window === \"undefined\") {\n    return null;\n  }\n\n  const value = (window as Window & { __WEBFRAMEZ_ROUTER__?: RouterClient })[GLOBAL_ROUTER_KEY];\n  return value ?? null;\n}\n\nfunction writeGlobalRouter(router: RouterClient) {\n  if (typeof window === \"undefined\") {\n    return;\n  }\n\n  (window as Window & { __WEBFRAMEZ_ROUTER__?: RouterClient })[GLOBAL_ROUTER_KEY] = router;\n}\n\nfunction parseBrowserCookies() {\n  const result: Record<string, string> = {};\n  const raw = typeof document === \"undefined\" ? \"\" : document.cookie;\n  if (!raw || raw.trim() === \"\") {\n    return result;\n  }\n\n  for (const part of raw.split(\";\")) {\n    const trimmed = part.trim();\n    if (!trimmed) {\n      continue;\n    }\n\n    const eqIndex = trimmed.indexOf(\"=\");\n    const name = eqIndex >= 0 ? trimmed.slice(0, eqIndex).trim() : trimmed;\n    const value = eqIndex >= 0 ? trimmed.slice(eqIndex + 1) : \"\";\n    if (!name) {\n      continue;\n    }\n    result[name] = decodeURIComponent(value);\n  }\n\n  return result;\n}\n\nfunction buildCookieString(name: string, value: string, options: CookieOptions = {}) {\n  const cookieParts = [`${name}=${encodeURIComponent(value)}`];\n\n  if (options.path) {\n    cookieParts.push(`Path=${options.path}`);\n  }\n  if (options.domain) {\n    cookieParts.push(`Domain=${options.domain}`);\n  }\n  if (typeof options.maxAge === \"number\") {\n    cookieParts.push(`Max-Age=${Math.floor(options.maxAge)}`);\n  }\n  if (options.expires) {\n    cookieParts.push(`Expires=${options.expires.toUTCString()}`);\n  }\n  if (options.sameSite) {\n    cookieParts.push(`SameSite=${options.sameSite}`);\n  }\n  if (options.secure) {\n    cookieParts.push(\"Secure\");\n  }\n\n  return cookieParts.join(\"; \");\n}\n\nexport function useCookie(): CookieClient {\n  return React.useMemo(\n    () => ({\n      all: () => parseBrowserCookies(),\n      get: (name) => parseBrowserCookies()[name],\n      set: (name, value, options) => {\n        if (typeof document === \"undefined\") {\n          return;\n        }\n        document.cookie = buildCookieString(name, value, options);\n      },\n      remove: (name, options) => {\n        if (typeof document === \"undefined\") {\n          return;\n        }\n        document.cookie = buildCookieString(name, \"\", {\n          ...(options ?? {}),\n          maxAge: 0,\n        });\n      },\n    }),\n    []\n  );\n}\n\nexport function useRouter(): RouterClient {\n  const value = RouterContext ? React.useContext(RouterContext) : null;\n  if (!value) {\n    const globalRouter = readGlobalRouter();\n    if (globalRouter) {\n      return globalRouter;\n    }\n    if (typeof window === \"undefined\") {\n      return noopRouter;\n    }\n    throw new Error(\"useRouter must be used inside mountWebframezClient()\");\n  }\n  return value;\n}\n\nfunction LoaderBar({ active }: { active: boolean }) {\n  return (\n    <div\n      style={{\n        position: \"fixed\",\n        top: 0,\n        left: 0,\n        width: \"100%\",\n        height: 3,\n        zIndex: 9999,\n        transformOrigin: \"left\",\n        transform: active ? \"scaleX(1)\" : \"scaleX(0)\",\n        transition: \"transform 180ms ease\",\n        background: \"linear-gradient(90deg, #0ea5e9, #22c55e)\",\n      }}\n    />\n  );\n}\n\nfunction createApp(rscEndpoint: string) {\n  return function App() {\n    const [tree, setTree] = useState<React.ReactNode>(null);\n    const [pending, setPending] = useState(false);\n\n    async function navigate(url: URL, mode: \"push\" | \"replace\" | \"none\" = \"push\") {\n      setPending(true);\n\n      try {\n        const response = createFromFetch(\n          fetch(\n            `${rscEndpoint}?path=${encodeURIComponent(url.pathname)}&search=${encodeURIComponent(url.search)}`,\n            {\n              headers: {\n                Accept: \"text/x-component\",\n              },\n            }\n          )\n        );\n\n        const nextTree = await (response as Promise<React.ReactNode>);\n        setTree(nextTree);\n\n        const nextHref = `${url.pathname}${url.search}`;\n        if (mode === \"replace\") {\n          history.replaceState(null, \"\", nextHref);\n        } else if (mode === \"push\") {\n          history.pushState(null, \"\", nextHref);\n        }\n      } catch (error) {\n        console.error(\"[webframez-react] Failed to render route\", error);\n        setTree(<p>Failed to load route.</p>);\n      } finally {\n        setPending(false);\n      }\n    }\n\n    useEffect(() => {\n      const onPopState = () => {\n        navigate(new URL(window.location.href), \"none\");\n      };\n\n      window.addEventListener(\"popstate\", onPopState);\n\n      navigate(new URL(window.location.href), \"none\");\n\n      return () => {\n        window.removeEventListener(\"popstate\", onPopState);\n      };\n    }, []);\n\n    const routerValue = React.useMemo<RouterClient>(\n      () => ({\n        push: (href: string) => {\n          void navigate(new URL(href, window.location.origin), \"push\");\n        },\n        replace: (href: string) => {\n          void navigate(new URL(href, window.location.origin), \"replace\");\n        },\n        refresh: () => {\n          void navigate(new URL(window.location.href), \"none\");\n        },\n      }),\n      []\n    );\n    writeGlobalRouter(routerValue);\n\n    if (!RouterContext) {\n      return (\n        <>\n          <LoaderBar active={pending} />\n          {tree ?? <p style={{ padding: 24 }}>Loading...</p>}\n        </>\n      );\n    }\n\n    return (\n      <RouterContext.Provider value={routerValue}>\n        <LoaderBar active={pending} />\n        {tree ?? <p style={{ padding: 24 }}>Loading...</p>}\n      </RouterContext.Provider>\n    );\n  };\n}\n\nexport function mountWebframezClient(options: ClientOptions = {}) {\n  const rootId = options.rootId ?? \"root\";\n  const rootEl = document.getElementById(rootId);\n  if (!rootEl) {\n    throw new Error(`Missing #${rootId} element`);\n  }\n\n  const endpointFromGlobal =\n    typeof window !== \"undefined\" && (window as Window & { __RSC_ENDPOINT?: string }).__RSC_ENDPOINT;\n  const rscEndpoint = options.rscEndpoint ?? endpointFromGlobal ?? \"/rsc\";\n\n  const App = createApp(rscEndpoint);\n  const root = createRoot(rootEl);\n  root.render(<App />);\n\n  return root;\n}\n"],
  "mappings": "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",
  "names": ["import_client", "React"]
}
