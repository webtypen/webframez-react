{
  "version": 3,
  "sources": ["../src/http.ts", "../src/server.ts", "../src/file-router.tsx", "../src/router-runtime.tsx"],
  "sourcesContent": ["import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { execFile } from \"node:child_process\";\nimport type { IncomingMessage, ServerResponse } from \"node:http\";\nimport { createHTMLShell, sendRSC } from \"./server\";\nimport { createFileRouter, parseSearchParams, renderHeadToString } from \"./router\";\n\nexport type CreateNodeHandlerOptions = {\n  distRootDir: string;\n  pagesDir?: string;\n  manifestPath?: string;\n  assetsPrefix?: string;\n  rscPath?: string;\n  clientScriptUrl?: string;\n  basePath?: string;\n  liveReloadPath?: string | false;\n};\n\nfunction normalizeBasePath(basePath?: string) {\n  if (!basePath || basePath === \"/\") {\n    return \"\";\n  }\n\n  const withLeadingSlash = basePath.startsWith(\"/\") ? basePath : `/${basePath}`;\n  return withLeadingSlash.endsWith(\"/\")\n    ? withLeadingSlash.slice(0, -1)\n    : withLeadingSlash;\n}\n\nfunction stripBasePath(pathname: string, basePath: string) {\n  if (!basePath) {\n    return pathname;\n  }\n\n  if (pathname === basePath) {\n    return \"/\";\n  }\n\n  if (pathname.startsWith(`${basePath}/`)) {\n    return pathname.slice(basePath.length) || \"/\";\n  }\n\n  return pathname;\n}\n\nfunction runNodeCommand(args: string[]) {\n  return new Promise<{ stdout: string; stderr: string }>((resolve, reject) => {\n    execFile(process.execPath, args, { timeout: 10_000, maxBuffer: 1024 * 1024 * 5 }, (error, stdout, stderr) => {\n      if (error) {\n        const out = stderr && stderr.trim() !== \"\" ? stderr : stdout;\n        reject(new Error(out || error.message));\n        return;\n      }\n\n      resolve({ stdout, stderr });\n    });\n  });\n}\n\nasync function renderInitialHtmlInWorker(options: {\n  pagesDir: string;\n  pathname: string;\n  searchParams: Record<string, string | string[]>;\n  cookies: Record<string, string>;\n  basename?: string;\n}) {\n  const payload = Buffer.from(JSON.stringify(options), \"utf8\").toString(\"base64url\");\n  const script = `\nconst path = require(\"node:path\");\nconst Module = require(\"node:module\");\nconst input = JSON.parse(Buffer.from(process.argv[1], \"base64url\").toString(\"utf8\"));\nglobalThis.__RSC_BASENAME = input.basename || \"\";\nconst appRequire = Module.createRequire(path.join(input.pagesDir, \"__webframez_react_worker__.js\"));\nconst originalResolveFilename = Module._resolveFilename;\nconst forcedResolutions = new Map([\n  [\"react\", appRequire.resolve(\"react\")],\n  [\"react/jsx-runtime\", appRequire.resolve(\"react/jsx-runtime\")],\n  [\"react/jsx-dev-runtime\", appRequire.resolve(\"react/jsx-dev-runtime\")],\n  [\"react-dom/client\", appRequire.resolve(\"react-dom/client\")]\n]);\nModule._resolveFilename = function(request, parent, isMain, options) {\n  if (forcedResolutions.has(request)) {\n    return forcedResolutions.get(request);\n  }\n  return originalResolveFilename.call(this, request, parent, isMain, options);\n};\nconst { createFileRouter } = require(\"webframez-react/router\");\nconst reactDomPkg = require.resolve(\"react-dom/package.json\", {\n  paths: [process.cwd(), input.pagesDir]\n});\nconst reactDomServer = require(path.join(path.dirname(reactDomPkg), \"server.node.js\"));\n\n(async () => {\n  const router = createFileRouter({ pagesDir: input.pagesDir });\n  const resolved = await router.resolve({\n    pathname: input.pathname,\n    searchParams: input.searchParams || {},\n    cookies: input.cookies || {},\n  });\n  const html = reactDomServer.renderToString(resolved.model);\n  process.stdout.write(JSON.stringify({ html }));\n})().catch((error) => {\n  process.stderr.write(error && (error.stack || String(error)) ? (error.stack || String(error)) : \"Unknown SSR worker error\");\n  process.exit(1);\n});\n`;\n\n  const { stdout } = await runNodeCommand([\"-e\", script, payload]);\n  const parsed = JSON.parse(stdout || \"{}\") as { html?: string };\n  return parsed.html || \"\";\n}\n\nfunction withRequestBasename<T>(basename: string, fn: () => Promise<T> | T) {\n  const target = globalThis as { __RSC_BASENAME?: string };\n  const previous = target.__RSC_BASENAME;\n  target.__RSC_BASENAME = basename;\n\n  const finish = () => {\n    target.__RSC_BASENAME = previous;\n  };\n\n  try {\n    const result = fn();\n    if (result && typeof (result as Promise<T>).then === \"function\") {\n      return (result as Promise<T>).finally(finish);\n    }\n    finish();\n    return result;\n  } catch (error) {\n    finish();\n    throw error;\n  }\n}\n\nfunction parseCookies(rawCookieHeader?: string | string[]) {\n  const raw = Array.isArray(rawCookieHeader)\n    ? rawCookieHeader.join(\"; \")\n    : rawCookieHeader ?? \"\";\n  const output: Record<string, string> = {};\n\n  if (!raw || raw.trim() === \"\") {\n    return output;\n  }\n\n  for (const pair of raw.split(\";\")) {\n    const part = pair.trim();\n    if (!part) {\n      continue;\n    }\n\n    const eqIndex = part.indexOf(\"=\");\n    const name = eqIndex >= 0 ? part.slice(0, eqIndex).trim() : part.trim();\n    const value = eqIndex >= 0 ? part.slice(eqIndex + 1).trim() : \"\";\n\n    if (!name) {\n      continue;\n    }\n\n    output[name] = decodeURIComponent(value);\n  }\n\n  return output;\n}\n\nexport function createNodeRequestHandler(options: CreateNodeHandlerOptions) {\n  const devServerId = `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 8)}`;\n  const distRootDir = path.resolve(options.distRootDir);\n  const pagesDir = path.resolve(options.pagesDir ?? path.join(distRootDir, \"pages\"));\n  const manifestPath = path.resolve(\n    options.manifestPath ?? path.join(distRootDir, \"react-client-manifest.json\")\n  );\n  const assetsPrefix = options.assetsPrefix ?? \"/assets/\";\n  const rscPath = options.rscPath ?? \"/rsc\";\n  const clientScriptUrl = options.clientScriptUrl ?? \"/assets/client.js\";\n  const basePath = normalizeBasePath(options.basePath);\n  const nodeEnv = process.env.NODE_ENV || \"\";\n  const runningInWatchMode = Array.isArray(process.execArgv) && process.execArgv.includes(\"--watch\");\n  const liveReloadEnabled =\n    options.liveReloadPath !== false && (nodeEnv === \"development\" || runningInWatchMode);\n  const liveReloadPath =\n    !liveReloadEnabled\n      ? \"\"\n      : options.liveReloadPath ?? `${basePath || \"\"}/__webframez_live_reload`;\n  const liveReloadClients = new Set<ServerResponse>();\n\n  const router = createFileRouter({ pagesDir });\n  const moduleMap = JSON.parse(fs.readFileSync(manifestPath, \"utf-8\"));\n\n  return async function handleRequest(req: IncomingMessage, res: ServerResponse) {\n    if (!req.url) {\n      res.statusCode = 400;\n      res.end(\"Bad request\");\n      return;\n    }\n\n    const url = new URL(req.url, \"http://localhost\");\n    const requestCookies = parseCookies(req.headers.cookie);\n\n    if (liveReloadPath && url.pathname === liveReloadPath) {\n      const accept = String(req.headers.accept || \"\");\n      if (accept.includes(\"text/event-stream\")) {\n        res.statusCode = 200;\n        res.setHeader(\"Content-Type\", \"text/event-stream; charset=utf-8\");\n        res.setHeader(\"Cache-Control\", \"no-store, no-cache, must-revalidate, proxy-revalidate\");\n        res.setHeader(\"Connection\", \"keep-alive\");\n        res.setHeader(\"X-Accel-Buffering\", \"no\");\n        if (typeof res.flushHeaders === \"function\") {\n          res.flushHeaders();\n        }\n\n        res.write(`retry: 400\\n`);\n        res.write(`data: ${JSON.stringify({ serverId: devServerId })}\\n\\n`);\n\n        liveReloadClients.add(res);\n        const heartbeat = setInterval(() => {\n          if (!res.writableEnded && !res.destroyed) {\n            res.write(`: ping\\n\\n`);\n          }\n        }, 15_000);\n\n        const cleanup = () => {\n          clearInterval(heartbeat);\n          liveReloadClients.delete(res);\n        };\n        req.on(\"close\", cleanup);\n        res.on(\"close\", cleanup);\n        return;\n      }\n\n      res.statusCode = 200;\n      res.setHeader(\"Content-Type\", \"application/json; charset=utf-8\");\n      res.setHeader(\"Cache-Control\", \"no-store, no-cache, must-revalidate, proxy-revalidate\");\n      res.end(JSON.stringify({ serverId: devServerId, clients: liveReloadClients.size }));\n      return;\n    }\n\n    if (url.pathname === rscPath) {\n      const pathname = stripBasePath(url.searchParams.get(\"path\") || \"/\", basePath);\n      const search = new URLSearchParams(url.searchParams.get(\"search\") || \"\");\n      const resolved = await withRequestBasename(basePath, () =>\n        router.resolve({\n          pathname,\n          searchParams: parseSearchParams(search),\n          cookies: requestCookies,\n        })\n      );\n\n      sendRSC(res, resolved.model, {\n        moduleMap,\n        statusCode: resolved.statusCode,\n      });\n      return;\n    }\n\n    if (url.pathname.startsWith(assetsPrefix)) {\n      const relative = url.pathname.slice(assetsPrefix.length);\n      const filePath = path.resolve(distRootDir, relative);\n      if (!filePath.startsWith(distRootDir)) {\n        res.statusCode = 400;\n        res.end(\"Invalid path\");\n        return;\n      }\n\n      const ext = path.extname(filePath);\n      if (ext === \".js\" || ext === \".mjs\") {\n        res.setHeader(\"Content-Type\", \"text/javascript; charset=utf-8\");\n      } else if (ext === \".json\") {\n        res.setHeader(\"Content-Type\", \"application/json; charset=utf-8\");\n      }\n\n      const stream = fs.createReadStream(filePath);\n      stream.on(\"error\", () => {\n        res.statusCode = 404;\n        res.end(\"Not found\");\n      });\n      stream.pipe(res);\n      return;\n    }\n\n    const resolved = await withRequestBasename(basePath, () =>\n      router.resolve({\n        pathname: stripBasePath(url.pathname, basePath),\n        searchParams: parseSearchParams(url.searchParams),\n        cookies: requestCookies,\n      })\n    );\n    let rootHtml = \"\";\n    try {\n      rootHtml = await renderInitialHtmlInWorker({\n        pagesDir,\n        pathname: stripBasePath(url.pathname, basePath),\n        searchParams: parseSearchParams(url.searchParams),\n        cookies: requestCookies,\n        basename: basePath,\n      });\n    } catch (error) {\n      console.error(\"[webframez-react] Failed to render initial HTML\", error);\n    }\n\n    res.statusCode = resolved.statusCode;\n    res.setHeader(\"Content-Type\", \"text/html\");\n    res.end(\n      createHTMLShell({\n        title: resolved.head.title || \"Webframez React\",\n        headTags: renderHeadToString(resolved.head),\n        clientScriptUrl,\n        rscEndpoint: rscPath,\n        rootHtml,\n        basename: basePath,\n        liveReloadPath: liveReloadPath || undefined,\n        liveReloadServerId: liveReloadPath ? devServerId : undefined,\n      })\n    );\n  };\n}\n", "import { renderToPipeableStream } from \"react-server-dom-webpack/server\";\nimport type { IncomingMessage, ServerResponse } from \"node:http\";\nimport type { CreateHtmlShellOptions, SendRSCOptions } from \"./types\";\n\nfunction defaultOnError(err: unknown) {\n  console.error(\"[webframez-react] RSC render error\", err);\n}\n\nexport function createHTMLShell(options: CreateHtmlShellOptions = {}) {\n  const {\n    title = \"RSC App\",\n    rscEndpoint = \"/rsc\",\n    clientScriptUrl = \"/client.js\",\n    headTags = \"\",\n    rootHtml = \"\",\n    basename = \"\",\n    liveReloadPath,\n    liveReloadServerId,\n  } = options;\n\n  const liveReloadScript =\n    liveReloadPath && liveReloadServerId\n      ? `<script>\n(() => {\n  const endpoint = ${JSON.stringify(liveReloadPath)};\n  let currentServerId = ${JSON.stringify(liveReloadServerId)};\n\n  const connect = () => {\n    const source = new EventSource(endpoint);\n\n    source.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        const nextServerId =\n          data && typeof data.serverId === \"string\" ? data.serverId : \"\";\n\n        if (nextServerId && nextServerId !== currentServerId) {\n          currentServerId = nextServerId;\n          window.location.reload();\n        }\n      } catch {\n        // Ignore malformed payloads in dev mode.\n      }\n    };\n\n    source.onerror = () => {\n      source.close();\n      setTimeout(connect, 350);\n    };\n  };\n\n  connect();\n})();\n</script>`\n      : \"\";\n\n  return `<!doctype html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n    <title>${title}</title>\n    ${headTags}\n  </head>\n  <body>\n    <div id=\"root\">${rootHtml}</div>\n    <script>window.__RSC_ENDPOINT = \"${rscEndpoint}\";</script>\n    <script>window.__RSC_BASENAME = \"${basename}\";</script>\n    <script type=\"module\" src=\"${clientScriptUrl}\"></script>\n    ${liveReloadScript}\n  </body>\n</html>`;\n}\n\nexport function sendRSC(\n  res: ServerResponse,\n  model: unknown,\n  options: SendRSCOptions = {}\n) {\n  const {\n    moduleMap = {},\n    onError = defaultOnError,\n    statusCode = 200,\n    contentType = \"text/x-component\",\n  } = options;\n\n  res.statusCode = statusCode;\n  res.setHeader(\"Content-Type\", contentType);\n\n  const stream = renderToPipeableStream(model, moduleMap, { onError });\n  stream.pipe(res);\n\n  return stream;\n}\n\nexport function createRSCHandler(options: {\n  rscPath?: string;\n  getModel: (req: IncomingMessage) => Promise<unknown> | unknown;\n  moduleMap?: Record<string, unknown>;\n  onError?: (error: unknown) => void;\n}): (req: IncomingMessage, res: ServerResponse) => Promise<boolean> {\n  const {\n    rscPath = \"/rsc\",\n    getModel,\n    moduleMap = {},\n    onError = defaultOnError,\n  } = options;\n\n  if (typeof getModel !== \"function\") {\n    throw new Error(\"createRSCHandler requires a getModel(req) function\");\n  }\n\n  return async function rscHandler(req, res) {\n    const url = new URL(req.url || \"/\", `http://${req.headers.host || \"localhost\"}`);\n\n    if (url.pathname !== rscPath) {\n      return false;\n    }\n\n    try {\n      const model = await getModel(req);\n      sendRSC(res, model, { moduleMap, onError });\n      return true;\n    } catch (err) {\n      onError(err);\n      res.statusCode = 500;\n      res.setHeader(\"Content-Type\", \"text/plain\");\n      res.end(\"RSC render error\");\n      return true;\n    }\n  };\n}\n", "import fs from \"node:fs\";\nimport path from \"node:path\";\nimport React from \"react\";\nimport { injectRouteChildren } from \"./router-runtime\";\nimport type {\n  AbortRouteOptions,\n  ErrorModule,\n  ErrorPageProps,\n  HeadConfig,\n  LayoutModule,\n  PageModule,\n  RouteContext,\n  RouteParams,\n  RouteSearchParams,\n} from \"./types\";\n\ntype RouteEntry = {\n  filePath: string;\n  segments: string[];\n  staticCount: number;\n};\n\ntype ResolveInput = {\n  pathname: string;\n  searchParams: RouteSearchParams;\n  cookies?: Record<string, string>;\n};\n\ntype RouteAbort = {\n  __webframezRouteAbort: true;\n  statusCode: number;\n  message: string;\n  payload?: unknown;\n};\n\nexport type ResolvedRoute = {\n  statusCode: number;\n  model: React.ReactNode;\n  head: HeadConfig;\n};\n\nfunction normalizePathname(pathname: string) {\n  const trimmed = pathname.replace(/\\/+$/, \"\") || \"/\";\n  return trimmed.startsWith(\"/\") ? trimmed : `/${trimmed}`;\n}\n\nfunction splitSegments(pathname: string) {\n  const normalized = normalizePathname(pathname);\n  if (normalized === \"/\") {\n    return [];\n  }\n\n  return normalized.slice(1).split(\"/\").filter(Boolean);\n}\n\nfunction walkFiles(dir: string): string[] {\n  if (!fs.existsSync(dir)) {\n    return [];\n  }\n\n  const result: string[] = [];\n  const stack = [dir];\n\n  while (stack.length > 0) {\n    const current = stack.pop();\n    if (!current) {\n      continue;\n    }\n\n    for (const entry of fs.readdirSync(current, { withFileTypes: true })) {\n      const fullPath = path.join(current, entry.name);\n      if (entry.isDirectory()) {\n        stack.push(fullPath);\n      } else if (entry.isFile()) {\n        result.push(fullPath);\n      }\n    }\n  }\n\n  return result;\n}\n\nfunction readSearchParams(urlSearchParams: URLSearchParams): RouteSearchParams {\n  const output: RouteSearchParams = {};\n\n  for (const key of urlSearchParams.keys()) {\n    const values = urlSearchParams.getAll(key);\n    output[key] = values.length <= 1 ? (values[0] ?? \"\") : values;\n  }\n\n  return output;\n}\n\nfunction escapeHtml(value: string) {\n  return value\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\\\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\nfunction toRouteEntry(pagesDir: string, filePath: string): RouteEntry | null {\n  const normalized = filePath.replace(/\\\\/g, \"/\");\n  if (!normalized.endsWith(\"/index.js\")) {\n    return null;\n  }\n\n  const relativeDir = path\n    .dirname(path.relative(pagesDir, filePath))\n    .replace(/\\\\/g, \"/\");\n  const segments = relativeDir === \".\" ? [] : relativeDir.split(\"/\").filter(Boolean);\n  const staticCount = segments.filter((segment) => !segment.startsWith(\"[\")).length;\n\n  return {\n    filePath,\n    segments,\n    staticCount,\n  };\n}\n\nfunction matchRoute(entry: RouteEntry, pathname: string): RouteParams | null {\n  const targetSegments = splitSegments(pathname);\n  if (entry.segments.length !== targetSegments.length) {\n    return null;\n  }\n\n  const params: RouteParams = {};\n\n  for (let index = 0; index < entry.segments.length; index += 1) {\n    const routeSegment = entry.segments[index];\n    const targetSegment = targetSegments[index];\n\n    if (routeSegment.startsWith(\"[\") && routeSegment.endsWith(\"]\")) {\n      const paramName = routeSegment.slice(1, -1);\n      if (!paramName) {\n        return null;\n      }\n      params[paramName] = decodeURIComponent(targetSegment);\n      continue;\n    }\n\n    if (routeSegment !== targetSegment) {\n      return null;\n    }\n  }\n\n  return params;\n}\n\nfunction mergeHead(...configs: Array<HeadConfig | undefined>) {\n  const merged: HeadConfig = {\n    meta: [],\n    links: [],\n  };\n\n  for (const config of configs) {\n    if (!config) {\n      continue;\n    }\n\n    if (config.title) {\n      merged.title = config.title;\n    }\n    if (config.description) {\n      merged.description = config.description;\n    }\n    if (config.favicon) {\n      merged.favicon = config.favicon;\n    }\n    if (config.meta) {\n      merged.meta?.push(...config.meta);\n    }\n    if (config.links) {\n      merged.links?.push(...config.links);\n    }\n  }\n\n  return merged;\n}\n\nexport function renderHeadToString(head: HeadConfig) {\n  const tags: string[] = [];\n\n  if (head.description) {\n    tags.push(\n      `<meta name=\\\"description\\\" content=\\\"${escapeHtml(head.description)}\\\" />`\n    );\n  }\n\n  if (head.favicon) {\n    tags.push(`<link rel=\\\"icon\\\" href=\\\"${escapeHtml(head.favicon)}\\\" />`);\n  }\n\n  for (const meta of head.meta ?? []) {\n    const attrs = Object.entries(meta)\n      .filter(([, value]) => Boolean(value))\n      .map(([key, value]) => `${key}=\\\"${escapeHtml(String(value))}\\\"`)\n      .join(\" \");\n    tags.push(`<meta ${attrs} />`);\n  }\n\n  for (const link of head.links ?? []) {\n    const attrs = Object.entries(link)\n      .filter(([, value]) => Boolean(value))\n      .map(([key, value]) => `${key}=\\\"${escapeHtml(String(value))}\\\"`)\n      .join(\" \");\n    tags.push(`<link ${attrs} />`);\n  }\n\n  return tags.join(\"\\n\");\n}\n\nfunction resolveModule<T>(modulePath: string): T {\n  delete require.cache[modulePath];\n  return require(modulePath) as T;\n}\n\nasync function resolveHead<TContext extends RouteContext | ErrorPageProps>(\n  candidate: { Head?: (context: TContext) => HeadConfig | Promise<HeadConfig> },\n  context: TContext\n) {\n  if (!candidate.Head) {\n    return undefined;\n  }\n\n  return candidate.Head(context);\n}\n\nfunction findBestMatch(entries: RouteEntry[], pathname: string) {\n  const matches: Array<{ entry: RouteEntry; params: RouteParams }> = [];\n\n  for (const entry of entries) {\n    const params = matchRoute(entry, pathname);\n    if (params) {\n      matches.push({ entry, params });\n    }\n  }\n\n  matches.sort((a, b) => {\n    if (b.entry.staticCount !== a.entry.staticCount) {\n      return b.entry.staticCount - a.entry.staticCount;\n    }\n    return b.entry.segments.length - a.entry.segments.length;\n  });\n\n  return matches[0] ?? null;\n}\n\nfunction normalizeAbortStatus(value: unknown) {\n  if (typeof value !== \"number\" || !Number.isFinite(value)) {\n    return 404;\n  }\n\n  const normalized = Math.trunc(value);\n  if (normalized < 100 || normalized > 599) {\n    return 404;\n  }\n\n  return normalized;\n}\n\nfunction createAbort(options?: AbortRouteOptions): RouteAbort {\n  return {\n    __webframezRouteAbort: true,\n    statusCode: normalizeAbortStatus(options?.status),\n    message: options?.message?.trim() || \"Page not found\",\n    payload: options?.payload,\n  };\n}\n\nfunction isRouteAbort(value: unknown): value is RouteAbort {\n  if (!value || typeof value !== \"object\") {\n    return false;\n  }\n\n  try {\n    return (value as RouteAbort).__webframezRouteAbort === true;\n  } catch {\n    return false;\n  }\n}\n\nexport function createFileRouter(options: { pagesDir: string }) {\n  const pagesDir = options.pagesDir;\n  const layoutPath = path.join(pagesDir, \"layout.js\");\n  const errorPath = path.join(pagesDir, \"errors.js\");\n\n  function buildRouteEntries() {\n    const files = walkFiles(pagesDir);\n    return files\n      .map((filePath) => toRouteEntry(pagesDir, filePath))\n      .filter((entry): entry is RouteEntry => entry !== null)\n      .sort((a, b) => {\n        if (b.staticCount !== a.staticCount) {\n          return b.staticCount - a.staticCount;\n        }\n        return b.segments.length - a.segments.length;\n      });\n  }\n\n  async function renderError(\n    context: RouteContext,\n    statusCode: number,\n    message: string,\n    payload?: unknown\n  ): Promise<ResolvedRoute> {\n    const errorProps: ErrorPageProps = {\n      ...context,\n      statusCode,\n      message,\n      payload,\n    };\n\n    const layoutModule = fs.existsSync(layoutPath)\n      ? resolveModule<LayoutModule>(layoutPath)\n      : null;\n\n    if (!fs.existsSync(errorPath)) {\n      const fallback = (\n        <main style={{ fontFamily: \"system-ui, sans-serif\", padding: 24 }}>\n          <h1>{statusCode}</h1>\n          <p>{message}</p>\n        </main>\n      );\n\n      return {\n        statusCode,\n        model: fallback,\n        head: {\n          title: `${statusCode} - ${message}`,\n        },\n      };\n    }\n\n    const errorModule = resolveModule<ErrorModule>(errorPath);\n    const errorNode = errorModule.default(errorProps);\n\n    const layoutHead = layoutModule\n      ? await resolveHead(layoutModule, context)\n      : undefined;\n    const errorHead = await resolveHead(errorModule, errorProps);\n\n    const model = layoutModule\n      ? injectRouteChildren(layoutModule.default(context), errorNode)\n      : errorNode;\n\n    return {\n      statusCode,\n      model,\n      head: mergeHead(layoutHead, errorHead),\n    };\n  }\n\n  async function resolve(input: ResolveInput): Promise<ResolvedRoute> {\n    const pathname = normalizePathname(input.pathname);\n    const contextBase: RouteContext = {\n      pathname,\n      params: {},\n      searchParams: input.searchParams,\n      cookies: input.cookies ?? {},\n      abort: (options?: AbortRouteOptions) => {\n        throw createAbort(options);\n      },\n    };\n    let activeContext: RouteContext = contextBase;\n\n    try {\n      const entries = buildRouteEntries();\n      const match = findBestMatch(entries, pathname);\n\n      if (!match) {\n        return renderError(contextBase, 404, \"Page not found\");\n      }\n\n      const context: RouteContext = {\n        ...contextBase,\n        params: match.params,\n      };\n      activeContext = context;\n\n      const pageModule = resolveModule<PageModule>(match.entry.filePath);\n      const layoutModule = fs.existsSync(layoutPath)\n        ? resolveModule<LayoutModule>(layoutPath)\n        : null;\n\n      const pageNode = pageModule.default(context);\n      const layoutHead = layoutModule\n        ? await resolveHead(layoutModule, context)\n        : undefined;\n      const pageHead = await resolveHead(pageModule, context);\n\n      const model = layoutModule\n        ? injectRouteChildren(layoutModule.default(context), pageNode)\n        : pageNode;\n\n      return {\n        statusCode: 200,\n        model,\n        head: mergeHead(layoutHead, pageHead),\n      };\n    } catch (error) {\n      if (isRouteAbort(error)) {\n        return renderError(activeContext, error.statusCode, error.message, error.payload);\n      }\n      console.error(\"[webframez-react] Failed to resolve route\", error);\n      return renderError(contextBase, 500, \"Internal server error\");\n    }\n  }\n\n  return {\n    resolve,\n    readSearchParams,\n  };\n}\n\nexport function parseSearchParams(query: URLSearchParams): RouteSearchParams {\n  return readSearchParams(query);\n}\n", "import React from \"react\";\n\nconst ROUTE_CHILDREN_TAG = \"webframez-route-children\";\nconst ROUTE_CHILDREN_SENTINEL = \"__webframezRouteChildren\";\nconst ROUTE_CHILDREN_DISPLAY_NAME = \"WebframezRouteChildren\";\n\ntype RouteChildrenType = {\n  (): React.ReactNode;\n  displayName?: string;\n  [ROUTE_CHILDREN_SENTINEL]?: boolean;\n};\n\nconst RouteChildrenImpl: RouteChildrenType = () => React.createElement(ROUTE_CHILDREN_TAG);\nRouteChildrenImpl.displayName = ROUTE_CHILDREN_DISPLAY_NAME;\nRouteChildrenImpl[ROUTE_CHILDREN_SENTINEL] = true;\n\nexport const RouteChildren = RouteChildrenImpl;\n\nfunction isRouteChildrenType(type: unknown) {\n  if (type === ROUTE_CHILDREN_TAG || type === RouteChildren) {\n    return true;\n  }\n\n  if (!type || (typeof type !== \"function\" && typeof type !== \"object\")) {\n    return false;\n  }\n\n  try {\n    const candidate = type as {\n      displayName?: string;\n      name?: string;\n      [ROUTE_CHILDREN_SENTINEL]?: boolean;\n    };\n\n    return (\n      candidate[ROUTE_CHILDREN_SENTINEL] === true ||\n      candidate.displayName === ROUTE_CHILDREN_DISPLAY_NAME ||\n      candidate.name === \"RouteChildren\"\n    );\n  } catch {\n    return false;\n  }\n}\n\nexport function injectRouteChildren(\n  node: React.ReactNode,\n  routeChildren: React.ReactNode\n): React.ReactNode {\n  if (node === null || node === undefined || typeof node === \"boolean\") {\n    return node;\n  }\n\n  if (Array.isArray(node)) {\n    let changed = false;\n    const next = node.map((child) => {\n      const injected = injectRouteChildren(child, routeChildren);\n      if (injected !== child) {\n        changed = true;\n      }\n      return injected;\n    });\n    return changed ? next : node;\n  }\n\n  if (!React.isValidElement(node)) {\n    return node;\n  }\n\n  if (isRouteChildrenType(node.type)) {\n    return routeChildren;\n  }\n\n  const props = node.props as { children?: React.ReactNode };\n  if (!(\"children\" in props)) {\n    return node;\n  }\n\n  const nextChildren = injectRouteChildren(props.children, routeChildren);\n  if (nextChildren === props.children) {\n    return node;\n  }\n\n  if (Array.isArray(nextChildren)) {\n    return React.cloneElement(node, undefined, ...nextChildren);\n  }\n\n  return React.cloneElement(node, undefined, nextChildren);\n}\n"],
  "mappings": "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",
  "names": ["fs", "path", "options", "path", "fs", "resolved"]
}
